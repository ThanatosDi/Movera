# Movera - æŠ€è¡“åˆ†æèˆ‡é–‹ç™¼æŒ‡å—

## ç°¡ä»‹

Movera æ˜¯ä¸€å€‹ç”±ä»»å‹™é©…å‹•çš„æª”æ¡ˆç®¡ç†èˆ‡è‡ªå‹•åŒ–å¹³å°ã€‚å…¶ä¸»è¦è¨­è¨ˆç›®çš„æ˜¯ç›£æ§å¦‚ä¸‹è¼‰å·¥å…·ï¼ˆä¾‹å¦‚ qBittorrentï¼‰çš„å®Œæˆäº‹ä»¶ï¼Œä¸¦æ ¹æ“šä½¿ç”¨è€…é å…ˆå®šç¾©çš„è¦å‰‡ï¼Œè‡ªå‹•å°æª”æ¡ˆé€²è¡Œé‡æ–°å‘½åå’Œç§»å‹•ã€‚

å°ˆæ¡ˆæä¾›äº†ä¸€å€‹ç¾ä»£åŒ–çš„ Web ä½¿ç”¨è€…ä»‹é¢ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥è¼•é¬†å»ºç«‹ã€ç®¡ç†å’Œç›£æ§é€™äº›è‡ªå‹•åŒ–ä»»å‹™ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **ä»»å‹™åŒ–ç®¡ç†**: ä»¥ã€Œä»»å‹™ã€ç‚ºæ ¸å¿ƒï¼Œæ¯å€‹ä»»å‹™å®šç¾©äº†ä¸€å¥—å®Œæ•´çš„æª”æ¡ˆè™•ç†æµç¨‹ã€‚
- **æ™ºæ…§é‡æ–°å‘½å**: æ”¯æ´å…©ç¨®é‡æ–°å‘½åæ¨¡å¼ï¼š
    1.  **Parse**: é€éç°¡å–®çš„æ¨£æ¿èªæ³•ï¼ˆå¦‚ `{name}.{ext}`ï¼‰é€²è¡ŒåŒ¹é…å’Œæ ¼å¼åŒ–ã€‚
    2.  **Regex**: ä½¿ç”¨åŠŸèƒ½å¼·å¤§çš„æ­£è¦è¡¨ç¤ºå¼é€²è¡Œè¤‡é›œçš„æª”ååŒ¹é…å’Œæ›¿æ›ã€‚
- **Webhook æ•´åˆ**: å…§å»º Webhook ç«¯é»ï¼Œå¯ç›´æ¥èˆ‡ qBittorrent ç­‰ä¸‹è¼‰è»Ÿé«”æ•´åˆï¼Œå¯¦ç¾ä¸‹è¼‰å®Œæˆå¾Œçš„ç„¡ç¸«è‡ªå‹•åŒ–è™•ç†ã€‚
- **è¦–è¦ºåŒ–é è¦½**: åœ¨å»ºç«‹å‘½åè¦å‰‡æ™‚ï¼Œæä¾›å³æ™‚çš„é è¦½åŠŸèƒ½ï¼Œç¢ºä¿è¦å‰‡çš„æ­£ç¢ºæ€§ã€‚
- **æ—¥èªŒèˆ‡ç›£æ§**: æ¯å€‹ä»»å‹™çš„åŸ·è¡Œéç¨‹å’Œçµæœéƒ½æœƒè¢«è©³ç´°è¨˜éŒ„ï¼Œæ–¹ä¾¿è¿½è¹¤èˆ‡é™¤éŒ¯ã€‚
- **Web UI ç®¡ç†**: æä¾›ä¸€å€‹åŸºæ–¼ Vue.js çš„å–®é æ‡‰ç”¨ç¨‹å¼ï¼ˆSPAï¼‰ï¼Œç”¨æ–¼ç®¡ç†æ‰€æœ‰ä»»å‹™ã€è¨­å®šå’ŒæŸ¥çœ‹æ—¥èªŒã€‚

## ğŸ› ï¸ æŠ€è¡“æ¶æ§‹

Movera æ¡ç”¨å‰å¾Œç«¯åˆ†é›¢çš„ç¾ä»£ Web æ‡‰ç”¨æ¶æ§‹ï¼Œä¸¦é€é Docker é€²è¡Œå®¹å™¨åŒ–éƒ¨ç½²ã€‚

- **å¾Œç«¯ (Backend)**
    - **æ¡†æ¶**: [FastAPI](https://fastapi.tiangolo.com/) (Python)
    - **è³‡æ–™åº« ORM**: [SQLAlchemy](https://www.sqlalchemy.org/)
    - **è³‡æ–™åº«é·ç§»**: [Alembic](https://alembic.sqlalchemy.org/)
    - **Web ä¼ºæœå™¨**: [Uvicorn](https://www.uvicorn.org/)
    - **å¥—ä»¶ç®¡ç†**: [uv](https://github.com/astral-sh/uv)

- **å‰ç«¯ (Frontend)**
    - **æ¡†æ¶**: [Vue.js 3](https://vuejs.org/) (ä½¿ç”¨ Composition API)
    - **èªè¨€**: [TypeScript](https://www.typescriptlang.org/)
    - **å»ºç½®å·¥å…·**: [Vite](https://vitejs.dev/)
    - **ç‹€æ…‹ç®¡ç†**: [Pinia](https://pinia.vuejs.org/)
    - **UI å…ƒä»¶åº«**: [Tailwind CSS](https://tailwindcss.com/) æ­é… class-variance-authority (é¡ä¼¼ Shadcn UI çš„é¢¨æ ¼)
    - **è·¯ç”±**: [Vue Router](https://router.vuejs.org/)
    - **åœ‹éš›åŒ–**: [Vue I18n](https://vue-i18n.intlify.dev/)

- **è³‡æ–™åº«**
    - é è¨­ä½¿ç”¨ **SQLite**ï¼Œè³‡æ–™åº«æª”æ¡ˆå„²å­˜æ–¼ `database/` ç›®éŒ„ä¸‹ï¼Œæ–¹ä¾¿è¼•é‡éƒ¨ç½²ã€‚

- **å®¹å™¨åŒ–**
    - **Docker** èˆ‡ **Docker Compose**ï¼Œç°¡åŒ–äº†éƒ¨ç½²å’Œç’°å¢ƒä¸€è‡´æ€§ã€‚

## ğŸš€ å¿«é€Ÿå•Ÿå‹• (ä½¿ç”¨ Docker)

1.  **å‰ç½®éœ€æ±‚**:
    - [Docker](https://www.docker.com/get-started)
    - [Docker Compose](https://docs.docker.com/compose/install/)

2.  **è¨­å®šç’°å¢ƒè®Šæ•¸**:
    å°ˆæ¡ˆä½¿ç”¨ `PUID` å’Œ `PGID` ä¾†è¨­å®šå®¹å™¨å…§æª”æ¡ˆçš„æ“æœ‰è€…ã€‚åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `.env` æª”æ¡ˆï¼š

    ```bash
    # .env
    PUID=1000
    PGID=1000
    ```
    *ä½ å¯ä»¥é€éåœ¨çµ‚ç«¯åŸ·è¡Œ `id` å‘½ä»¤ä¾†å–å¾—ä½ ç›®å‰çš„ PUID å’Œ PGIDã€‚*

3.  **åŸ·è¡Œå®¹å™¨ (Run Container)**:

    åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ä¾†å•Ÿå‹• Movera å®¹å™¨ã€‚è«‹æ ¹æ“šæ‚¨çš„éœ€æ±‚ä¿®æ”¹ `<HOST_PORT>`ã€‚

    <details>
    <summary>docker</summary>
        
    ```bash
    docker run -d \
      -p <HOST_PORT>:8000 \
      -v $(pwd)/database:/movera/database \
      -v $(pwd)/storages:/movera/storages \
      -v <downloader_path>:/download \
      --name movera \
      thanatosdi/movera:latest
    ```

    - `-d`: åœ¨èƒŒæ™¯åŸ·è¡Œå®¹å™¨ã€‚
    - `-p <HOST_PORT>:8000`: å°‡æ‚¨ä¸»æ©Ÿçš„ `<HOST_PORT>` é€£æ¥åŸ æ˜ å°„åˆ°å®¹å™¨å›ºå®šçš„ `8000` é€£æ¥åŸ ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ `-p 8888:8000`ï¼Œæ‚¨å°±å¯ä»¥é€é `http://localhost:8888` è¨ªå• Moveraã€‚
    - `-v $(pwd)/database:/movera/database`: **(å¿…è¦)** å°‡ä¸»æ©Ÿä¸Šå­˜æ”¾è³‡æ–™åº«æª”æ¡ˆçš„ `database` è³‡æ–™å¤¾æ›è¼‰åˆ°å®¹å™¨ä¸­ã€‚
    - `-v $(pwd)/storages:/movera/storages`: **(å¿…è¦)** å°‡ä¸»æ©Ÿä¸Šç”¨æ–¼å­˜å„²çš„ `storages` è³‡æ–™å¤¾æ›è¼‰åˆ°å®¹å™¨ä¸­ã€‚
    - `-v <downloader_path>:/download`: **(å¿…è¦)** å°‡ä¸»æ©Ÿä¸Šç”¨æ–¼ä¸‹è¼‰æª”æ¡ˆçš„è³‡æ–™å¤¾æ›è¼‰åˆ°å®¹å™¨ä¸­ã€‚
    </details>
    
    <details>
    <summary>docker compose</summary>
        
    ```yaml
    services:
      movera:
        image: thanatosdi/movera:latest
        container_name: movera
        ports:
          - "<HOST_PORT>:8000"
        volumes:
          - ./database:/movera/database
          - ./storages:/movera/storages
          - <downloader_path>:/download
        restart: unless-stopped
    ```
    - `ports` å€å¡Šå»ºè­°å®Œæ•´å¯«æ¸…æ¥šä¸»æ©Ÿå…§ç¶² IP ä½å€ï¼Œä¾‹å¦‚ `127.0.0.1:8000:8000` èˆ‡ `192.168.1.10:8000:8000` ä¹‹é¡çš„ï¼›å¦‚æœåªå¡«å¯« `8000:8000` è¡¨ç¤ºä»»ä½•ä¾†æºçš„ä¸»æ©Ÿéƒ½å¯ä»¥ç¹éé˜²ç«ç‰† `8000` åŸ é€²è¡Œè¨ªå•ã€‚
    </details>

4.  **å­˜å–æ‡‰ç”¨**:
    æœå‹™å•Ÿå‹•å¾Œï¼Œä½ å¯ä»¥é€éç€è¦½å™¨å­˜å– `http://localhost:8000` ä¾†ä½¿ç”¨ Moveraã€‚

## ğŸ“š API ç«¯é»

æ‰€æœ‰ API ç«¯é»çš†ä»¥ `/api/v1` ç‚ºå‰ç¶´ã€‚

#### `/tasks` - ä»»å‹™ç®¡ç†

- `GET /tasks`: ç²å–æ‰€æœ‰ä»»å‹™åˆ—è¡¨ã€‚
- `GET /task/{task_id}`: ç²å–æŒ‡å®š ID çš„ä»»å‹™è©³æƒ…ã€‚
- `POST /task`: å»ºç«‹ä¸€å€‹æ–°ä»»å‹™ã€‚
- `PUT /task/{task_id}`: æ›´æ–°æŒ‡å®š ID çš„ä»»å‹™ã€‚
- `DELETE /task/{task_id}`: åˆªé™¤æŒ‡å®š ID çš„ä»»å‹™ã€‚
- `GET /tasks/stats`: ç²å–ä»»å‹™çµ±è¨ˆæ•¸æ“šï¼ˆå•Ÿç”¨/åœç”¨æ•¸é‡ï¼‰ã€‚

#### `/log` - æ—¥èªŒç®¡ç†

- `GET /log/{task_id}`: ç²å–æŒ‡å®šä»»å‹™çš„æ‰€æœ‰æ—¥èªŒã€‚

#### `/settings` - è¨­å®šç®¡ç†

- `GET /settings`: ç²å–æ‰€æœ‰è¨­å®šã€‚
- `GET /setting/{key}`: ç²å–æŒ‡å®šéµåçš„è¨­å®šã€‚
- `PUT /settings`: æ›´æ–°å¤šå€‹è¨­å®šã€‚
- `PUT /setting/{key}`: æ›´æ–°æŒ‡å®šéµåçš„è¨­å®šã€‚

#### `/parse-preview` - è¦å‰‡é è¦½

- `POST /parse-preview`: æä¾›ä¾†æºæ–‡å­—ã€åŒ¹é…è¦å‰‡å’Œç›®æ¨™æ ¼å¼ï¼Œå›å‚³é è¦½çµæœã€‚

#### `/webhook` - Webhook æ•´åˆ

- `GET /webhook/status`: æª¢æŸ¥ Webhook æœå‹™ç‹€æ…‹ã€‚
- `POST /webhook/qbittorrent/on-complete`: æ¥æ”¶ qBittorrent ä¸‹è¼‰å®Œæˆçš„é€šçŸ¥ã€‚

#### `/health` - å¥åº·æª¢æŸ¥

- `GET /api/v1/health`: æª¢æŸ¥ API æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œã€‚

## ğŸ’» é–‹ç™¼æŒ‡å—

### å‰ç½®éœ€æ±‚

- Python 3.12+
- [uv](https://github.com/astral-sh/uv) (å»ºè­°çš„ Python å¥—ä»¶ç®¡ç†å™¨)
- Node.js 20+
- [npm](https://www.npmjs.com/) æˆ–ç›¸å®¹çš„å¥—ä»¶ç®¡ç†å™¨

### å¾Œç«¯é–‹ç™¼

1.  **å®‰è£ä¾è³´**:
    ```bash
    uv sync
    ```

2.  **åŸ·è¡Œè³‡æ–™åº«é·ç§»**:
    ```bash
    uv run alembic upgrade head
    ```

3.  **å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨**:
    ```bash
    uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload
    ```
    ä¼ºæœå™¨å°‡åœ¨ `http://localhost:8000` ä¸Šé‹è¡Œï¼Œä¸¦åœ¨ç¨‹å¼ç¢¼è®Šæ›´æ™‚è‡ªå‹•é‡è¼‰ã€‚

### å‰ç«¯é–‹ç™¼

1.  **é€²å…¥å‰ç«¯ç›®éŒ„ä¸¦å®‰è£ä¾è³´**:
    ```bash
    npm install
    ```

2. **è¨­å®šç’°å¢ƒè®Šæ•¸**:  
   åœ¨å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ä¸­ï¼Œæ‚¨å¯ä»¥è¨­å®šç’°å¢ƒè®Šæ•¸(.env) `VITE_API_BASE_URL` ä¾†æŒ‡å®šå¾Œç«¯ API çš„åŸºæœ¬ URLã€‚ä¾‹å¦‚ï¼š

    ```bash
    VITE_API_BASE_URL="http://localhost:8000"
    ```

3.  **å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨**:
    ```bash
    npm run dev
    ```
    Vite é–‹ç™¼ä¼ºæœå™¨å°‡å•Ÿå‹•ï¼Œä½ å¯ä»¥åœ¨çµ‚ç«¯è¼¸å‡ºçš„ä½å€ï¼ˆé€šå¸¸æ˜¯ `http://localhost:5173`ï¼‰ä¸Šçœ‹åˆ°å‰ç«¯ä»‹é¢ã€‚

### åŸ·è¡Œæ¸¬è©¦

å°ˆæ¡ˆä½¿ç”¨ `pytest` é€²è¡Œæ¸¬è©¦ã€‚

```bash
pytest
```
